<div class="container-fluid p-4 page-enter">

  <!-- ===== SEARCH & ACTION BAR ===== -->
  <div class="row mb-4">
    <div class="col-lg-8">

      <div class="card-shadow p-3 d-flex flex-wrap gap-3 align-items-center top-bar">

        <div class="flex-grow-1 position-relative">
          <input
            type="text"
            class="form-control search-input"
            placeholder="Search users..."
            [formControl]="searchControl">
          <span class="search-glow"></span>
        </div>

        <button class="btn btn-mint px-4 btn-float" routerLink="/nav/client/add">
          + New User
        </button>
      </div>

      <!-- ===== USERS TABLE ===== -->
      <div class="card-shadow p-3 mt-3 table-animate">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
          <tr class="ps-5">
            <th>Last Name</th>
            <th>First Name</th>
            <th>Email</th>
            <th></th>
          </tr>
          </thead>

          <tbody>
            @if (clients && Array.isArray(clients)) {
              @for (c of clients; track c.id) {
                <tr
                  class="fade-row"
                  (click)="slectedClient(c)"
                  [class.table-active]="clientSelected.id === c.id"
                  style="cursor:pointer">

                  <td class="fw-semibold">{{ c.nom }}</td>
                  <td>{{ c.prenom }}</td>
                  <td class="text-muted">{{ c.email }}</td>
                  <td></td>

                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== RIGHT PANEL ===== -->

    <div class="col-lg-4">

      <div class="card-shadow p-4 right-panel slide-in-soft">

        <h5 class="fw-bold mb-3">Selected User</h5>

        <div class="user-header mb-3">
          <div class="user-avatar-placeholder">
            {{ clientSelected.nom?.charAt(0) }}
          </div>

          <div>
            <h6 class="fw-bold mb-0">
              {{ clientSelected.nom }} {{ clientSelected.prenom }}
            </h6>
            <small class="text-muted">{{ clientSelected.email }}</small>
          </div>
        </div>

        <hr>

        <h6 class="fw-bold">Linked Accounts</h6>
        <ul class="account-list">
          <li *ngFor="let accId of clientSelected.accIDs">
            {{ accId }}
          </li>
        </ul>

        <h6 class="fw-bold mt-4">Quick Stats</h6>
        <ul class="list-unstyled small stats-list">
          <li>Accounts <span>{{ clientSelected.nbCompte }}</span></li>
          <li>Total Balance <span>{{ clientSelected.soldeTotale }} DH</span></li>
        </ul>

        <hr>

        @if (this.authService.roles.includes("ADMIN")) {
          <button
            class="btn btn-mint w-100 mb-2 btn-float"
            [routerLink]="['/nav/client/edit', clientSelected.id]">
            Edit User
          </button>
        }

        <button
          class="btn btn-outline-mint w-100 mb-2"
          [routerLink]="['/nav/accounts/', clientSelected.id]">
          Accounts
        </button>

        @if (this.authService.roles.includes("ADMIN")) {
          <button
            class="btn btn-outline-danger w-100 shake-hover"
            (click)="deleteClient(clientSelected)">
            Delete Client
          </button>
        }

      </div>
    </div>
  </div>
</div>
